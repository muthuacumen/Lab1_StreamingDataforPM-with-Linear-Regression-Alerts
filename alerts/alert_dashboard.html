<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Robot Health Monitor</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: #e0e0e0; }
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
header { text-align: center; padding: 30px 0 20px; }
header h1 { font-size: 2em; color: #ffffff; margin-bottom: 6px; }
header p.subtitle { font-size: 1.05em; color: #a0a0b8; margin-bottom: 4px; }
header p.timestamp { font-size: 0.9em; color: #7070a0; }
.cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin: 24px 0; }
.card { background: #16213e; border-radius: 10px; padding: 22px; text-align: center; border-left: 4px solid; transition: transform 0.15s; }
.card:hover { transform: translateY(-3px); }
.card .value { font-size: 2.4em; font-weight: 700; }
.card .label { font-size: 0.95em; color: #a0a0b8; margin-top: 6px; }
.card .desc { font-size: 0.78em; color: #707090; margin-top: 4px; }
.card-warn { border-color: #f0a500; }
.card-warn .value { color: #f0a500; }
.card-crit { border-color: #e74c3c; }
.card-crit .value { color: #e74c3c; }
.card-total { border-color: #3498db; }
.card-total .value { color: #3498db; }
.card-robots { border-color: #1abc9c; }
.card-robots .value { color: #1abc9c; }
.section { background: #16213e; border-radius: 10px; padding: 24px; margin: 20px 0; }
.section h2 { font-size: 1.3em; margin-bottom: 16px; color: #ffffff; }
table { width: 100%; border-collapse: collapse; font-size: 0.92em; }
th { background: #0f3460; padding: 10px 12px; text-align: left; font-weight: 600; color: #e0e0e0; cursor: pointer; user-select: none; white-space: nowrap; }
th:hover { background: #154080; }
td { padding: 9px 12px; border-bottom: 1px solid #1e2a4a; }
tr:hover td { background: #1a2744; }
.badge { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.82em; font-weight: 600; }
.badge-normal { background: #1e6e3e; color: #a0f0c0; }
.badge-warn { background: #6e5a1e; color: #f0d080; }
.badge-crit { background: #6e1e1e; color: #f0a0a0; }
.row-warn { background: rgba(240,165,0,0.07); }
.row-crit { background: rgba(231,76,60,0.07); }
.filters { display: flex; gap: 14px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
.filters label { font-size: 0.9em; color: #a0a0b8; }
.filters select { background: #0f3460; color: #e0e0e0; border: 1px solid #2a3a5e; border-radius: 6px; padding: 6px 10px; font-size: 0.9em; }
.chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
@media (max-width: 900px) { .chart-row { grid-template-columns: 1fr; } }
.chart-box { background: #16213e; border-radius: 10px; padding: 18px; }
footer { text-align: center; padding: 30px 0 20px; font-size: 0.82em; color: #606080; line-height: 1.7; }
.sort-arrow { font-size: 0.7em; margin-left: 3px; }
</style>
</head>
<body>
<div class="container">

<header>
  <h1>Robot Health Monitor &mdash; Predictive Maintenance Dashboard</h1>
  <p class="subtitle">Automated anomaly detection across all monitored robots and axes</p>
  <p class="timestamp">Report generated: Feb 06, 2026 at 10:42 PM</p>
</header>

<div class="cards" id="cards"></div>

<div class="section">
  <h2>Robot Health Overview</h2>
  <table id="robotTable">
    <thead><tr>
      <th>Robot</th><th>Status</th><th>Warnings</th><th>Critical</th><th>Total Events</th><th>Most Affected Axis</th><th>Recommended Action</th>
    </tr></thead>
    <tbody id="robotBody"></tbody>
  </table>
</div>

<div class="chart-row">
  <div class="chart-box"><div id="chartByRobot"></div></div>
  <div class="chart-box"><div id="chartByAxis"></div></div>
</div>

<div class="chart-box" style="margin: 20px 0;">
  <div id="chartTimeline"></div>
</div>

<div class="section">
  <h2>Detailed Event Log</h2>
  <div class="filters">
    <label>Robot: <select id="filterRobot"><option value="all">All Robots</option></select></label>
    <label>Type: <select id="filterType"><option value="all">All Types</option><option value="ALERT">Warning</option><option value="ERROR">Critical</option></select></label>
  </div>
  <table id="eventTable">
    <thead><tr>
      <th data-col="timestamp">Time</th>
      <th data-col="robot">Robot</th>
      <th data-col="axis">Axis</th>
      <th data-col="event_type">Type</th>
      <th data-col="deviation">Severity</th>
      <th data-col="duration_seconds">Duration (sec)</th>
      <th data-col="actual_value">Measured Value</th>
      <th data-col="predicted_value">Expected Value</th>
    </tr></thead>
    <tbody id="eventBody"></tbody>
  </table>
</div>

<footer>
  This report is auto-generated from the Predictive Maintenance system.
  <strong>Warning</strong> = sustained unusual current deviation.
  <strong>Critical</strong> = sustained severe current deviation requiring immediate attention.<br>
  Warning threshold: current deviating beyond 3.5&times; normal range for 5+ seconds.
  Critical threshold: current deviating beyond 4&times; normal range for 5+ seconds.
</footer>

</div>

<script>
// ---- Embedded Data ----
const DATA = [{"timestamp": "2024-07-01 13:23:55", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.5917, "duration_seconds": 5, "actual_value": 3.2261, "predicted_value": -0.1085, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:23:55", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.5917, "duration_seconds": 6, "actual_value": 3.3474, "predicted_value": -0.1085, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:13", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.2586, "duration_seconds": 5, "actual_value": 3.4739, "predicted_value": -0.1092, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:13", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.2586, "duration_seconds": 6, "actual_value": 3.8663, "predicted_value": -0.1092, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:13", "axis": "axis_9", "event_type": "ALERT", "deviation": 4.2586, "duration_seconds": 7, "actual_value": 2.6295, "predicted_value": -0.1092, "threshold_used": 3.5, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:25", "axis": "axis_9", "event_type": "ALERT", "deviation": 4.8146, "duration_seconds": 5, "actual_value": 2.7594, "predicted_value": -0.1093, "threshold_used": 3.5, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:25", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.8146, "duration_seconds": 6, "actual_value": 3.4124, "predicted_value": -0.1093, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 13:30:25", "axis": "axis_9", "event_type": "ERROR", "deviation": 4.8146, "duration_seconds": 7, "actual_value": 3.0794, "predicted_value": -0.1093, "threshold_used": 4.0, "robot": "Robot B"}, {"timestamp": "2024-07-01 12:48:32", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.6655, "duration_seconds": 5, "actual_value": 2.9164, "predicted_value": 0.0422, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:48:32", "axis": "axis_10", "event_type": "ERROR", "deviation": 3.6655, "duration_seconds": 6, "actual_value": 3.3595, "predicted_value": 0.0422, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:51:38", "axis": "axis_10", "event_type": "ERROR", "deviation": 3.2289, "duration_seconds": 5, "actual_value": 3.2711, "predicted_value": 0.0422, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:51:38", "axis": "axis_10", "event_type": "ERROR", "deviation": 3.2289, "duration_seconds": 6, "actual_value": 3.2103, "predicted_value": 0.0422, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:51:38", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.2289, "duration_seconds": 7, "actual_value": 3.149, "predicted_value": 0.0422, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:51:38", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.2289, "duration_seconds": 8, "actual_value": 2.9253, "predicted_value": 0.0422, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:51:38", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.2289, "duration_seconds": 9, "actual_value": 3.1231, "predicted_value": 0.0422, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 12:54:37", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.5561, "duration_seconds": 5, "actual_value": 2.8131, "predicted_value": 0.0423, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:02:44", "axis": "axis_10", "event_type": "ERROR", "deviation": 3.8222, "duration_seconds": 5, "actual_value": 3.2381, "predicted_value": 0.0424, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:08:34", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.2964, "duration_seconds": 5, "actual_value": 3.0429, "predicted_value": 0.0425, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:12", "axis": "axis_10", "event_type": "ERROR", "deviation": 3.9223, "duration_seconds": 5, "actual_value": 3.8701, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:19", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.2092, "duration_seconds": 5, "actual_value": 3.3937, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:19", "axis": "axis_10", "event_type": "ALERT", "deviation": 4.2092, "duration_seconds": 6, "actual_value": 3.1166, "predicted_value": 0.0426, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:21", "axis": "axis_11", "event_type": "ERROR", "deviation": 5.7049, "duration_seconds": 5, "actual_value": 3.9981, "predicted_value": 0.0869, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:40", "axis": "axis_11", "event_type": "ERROR", "deviation": 4.5249, "duration_seconds": 5, "actual_value": 4.6119, "predicted_value": 0.087, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:47", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.1615, "duration_seconds": 5, "actual_value": 4.2041, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:47", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.1715, "duration_seconds": 6, "actual_value": 4.2142, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:53", "axis": "axis_11", "event_type": "ERROR", "deviation": 4.8993, "duration_seconds": 5, "actual_value": 4.9863, "predicted_value": 0.087, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 5, "actual_value": 4.5099, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:53", "axis": "axis_11", "event_type": "ALERT", "deviation": 4.8993, "duration_seconds": 6, "actual_value": 3.1082, "predicted_value": 0.087, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 6, "actual_value": 4.333, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:53", "axis": "axis_11", "event_type": "ALERT", "deviation": 4.8993, "duration_seconds": 7, "actual_value": 3.1724, "predicted_value": 0.087, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 7, "actual_value": 3.9887, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 8, "actual_value": 3.7916, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 9, "actual_value": 4.269, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ALERT", "deviation": 4.4673, "duration_seconds": 10, "actual_value": 3.1226, "predicted_value": 0.0426, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ALERT", "deviation": 4.4673, "duration_seconds": 11, "actual_value": 3.0686, "predicted_value": 0.0426, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 12, "actual_value": 3.597, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:13:54", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.4673, "duration_seconds": 13, "actual_value": 3.7758, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:14:19", "axis": "axis_10", "event_type": "ERROR", "deviation": 4.1004, "duration_seconds": 5, "actual_value": 3.9555, "predicted_value": 0.0426, "threshold_used": 4.0, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:16:14", "axis": "axis_10", "event_type": "ALERT", "deviation": 3.7455, "duration_seconds": 5, "actual_value": 3.1273, "predicted_value": 0.0427, "threshold_used": 3.5, "robot": "Robot C"}, {"timestamp": "2024-07-01 13:21:07", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.3682, "duration_seconds": 5, "actual_value": 2.8011, "predicted_value": -0.1234, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:21:07", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.4879, "duration_seconds": 6, "actual_value": 3.3645, "predicted_value": -0.1234, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:25:20", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.3692, "duration_seconds": 5, "actual_value": 2.8715, "predicted_value": -0.1243, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:26:14", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2337, "duration_seconds": 5, "actual_value": 4.1092, "predicted_value": -0.1245, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:26:14", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2337, "duration_seconds": 6, "actual_value": 3.0066, "predicted_value": -0.1245, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:28:59", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.543, "duration_seconds": 5, "actual_value": 3.3454, "predicted_value": -0.1251, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:28:59", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.543, "duration_seconds": 6, "actual_value": 2.9106, "predicted_value": -0.1251, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:28:59", "axis": "axis_12", "event_type": "ERROR", "deviation": 3.543, "duration_seconds": 7, "actual_value": 3.0159, "predicted_value": -0.1251, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 5, "actual_value": 4.0872, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.2134, "duration_seconds": 6, "actual_value": 2.4426, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 7, "actual_value": 2.9283, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 8, "actual_value": 3.1905, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.2134, "duration_seconds": 9, "actual_value": 2.4445, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 10, "actual_value": 2.7661, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 11, "actual_value": 4.0305, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 12, "actual_value": 3.0288, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:12", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.2134, "duration_seconds": 13, "actual_value": 3.8671, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.1654, "duration_seconds": 5, "actual_value": 2.8236, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.1654, "duration_seconds": 6, "actual_value": 2.6067, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.1654, "duration_seconds": 7, "actual_value": 2.6707, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.1654, "duration_seconds": 8, "actual_value": 2.6747, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.1654, "duration_seconds": 9, "actual_value": 2.4105, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.1654, "duration_seconds": 10, "actual_value": 3.8203, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.1654, "duration_seconds": 11, "actual_value": 2.5254, "predicted_value": -0.1263, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:26", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.1654, "duration_seconds": 12, "actual_value": 2.9392, "predicted_value": -0.1263, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:39", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.2414, "duration_seconds": 5, "actual_value": 2.4911, "predicted_value": -0.1264, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 5, "actual_value": 3.9309, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ALERT", "deviation": 4.335, "duration_seconds": 6, "actual_value": 2.3752, "predicted_value": -0.1264, "threshold_used": 3.5, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 7, "actual_value": 3.9934, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 8, "actual_value": 3.652, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 9, "actual_value": 3.8722, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 10, "actual_value": 3.8751, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}, {"timestamp": "2024-07-01 13:34:45", "axis": "axis_12", "event_type": "ERROR", "deviation": 4.335, "duration_seconds": 11, "actual_value": 3.9404, "predicted_value": -0.1264, "threshold_used": 4.0, "robot": "Robot D"}];
const ALL_ROBOTS = ["Robot A", "Robot B", "Robot C", "Robot D"];

// ---- Helpers ----
function typeLabel(t) { return t === 'ERROR' ? 'Critical' : 'Warning'; }
function typeBadge(t) {
  const cls = t === 'ERROR' ? 'badge-crit' : 'badge-warn';
  return '<span class="badge ' + cls + '">' + typeLabel(t) + '</span>';
}
function statusBadge(warns, crits) {
  if (crits > 0) return '<span class="badge badge-crit">Critical</span>';
  if (warns > 0) return '<span class="badge badge-warn">Needs Attention</span>';
  return '<span class="badge badge-normal">Normal</span>';
}
function fmtTime(ts) {
  try {
    const d = new Date(ts);
    if (isNaN(d)) return ts;
    return d.toLocaleString('en-US', {month:'short',day:'numeric',year:'numeric',hour:'numeric',minute:'2-digit',second:'2-digit'});
  } catch(e) { return ts; }
}

// ---- Compute Stats ----
const robots = ALL_ROBOTS;
const warnings = DATA.filter(d => d.event_type === 'ALERT').length;
const criticals = DATA.filter(d => d.event_type === 'ERROR').length;

// ---- Summary Cards ----
document.getElementById('cards').innerHTML =
  '<div class="card card-warn"><div class="value">' + warnings + '</div><div class="label">Warnings</div><div class="desc">Axes showing early signs of unusual behavior</div></div>' +
  '<div class="card card-crit"><div class="value">' + criticals + '</div><div class="label">Critical Alerts</div><div class="desc">Axes requiring immediate inspection</div></div>' +
  '<div class="card card-total"><div class="value">' + DATA.length + '</div><div class="label">Total Events</div><div class="desc">Total anomalies detected across all robots</div></div>' +
  '<div class="card card-robots"><div class="value">' + robots.length + '</div><div class="label">Robots Monitored</div><div class="desc">Number of robots in this analysis</div></div>';

// ---- Robot Health Table ----
(function() {
  const body = document.getElementById('robotBody');
  robots.forEach(r => {
    const evts = DATA.filter(d => d.robot === r);
    const w = evts.filter(d => d.event_type === 'ALERT').length;
    const c = evts.filter(d => d.event_type === 'ERROR').length;
    const total = evts.length;
    // Most affected axis
    const axisCounts = {};
    evts.forEach(d => { axisCounts[d.axis] = (axisCounts[d.axis]||0) + 1; });
    const topAxis = Object.keys(axisCounts).sort((a,b) => axisCounts[b]-axisCounts[a])[0] || '--';
    let action = 'No action needed';
    if (c > 0) action = 'Immediate inspection required for ' + topAxis;
    else if (w > 0) action = 'Schedule inspection for ' + topAxis;
    const tr = document.createElement('tr');
    tr.innerHTML = '<td>' + r + '</td><td>' + statusBadge(w,c) + '</td><td>' + w + '</td><td>' + c + '</td><td>' + total + '</td><td>' + topAxis + '</td><td>' + action + '</td>';
    body.appendChild(tr);
  });
})();

// ---- Chart: Events by Robot (stacked bar) ----
(function(){
  const warnCounts = robots.map(r => DATA.filter(d => d.robot === r && d.event_type === 'ALERT').length);
  const critCounts = robots.map(r => DATA.filter(d => d.robot === r && d.event_type === 'ERROR').length);
  Plotly.newPlot('chartByRobot', [
    { x: robots, y: warnCounts, name: 'Warning', type: 'bar', marker: { color: '#f0a500' } },
    { x: robots, y: critCounts, name: 'Critical', type: 'bar', marker: { color: '#e74c3c' } }
  ], {
    barmode: 'stack',
    title: { text: 'Anomaly Count by Robot', font: { color: '#fff', size: 16 } },
    yaxis: { title: 'Number of Anomalies', color: '#a0a0b8', gridcolor: '#1e2a4a' },
    xaxis: { color: '#a0a0b8' },
    paper_bgcolor: '#16213e', plot_bgcolor: '#16213e',
    legend: { font: { color: '#e0e0e0' } },
    margin: { t: 50, b: 40, l: 50, r: 20 }
  }, { responsive: true });
})();

// ---- Chart: Events by Axis (stacked bar, sorted) ----
(function(){
  const allAxes = [...new Set(DATA.map(d => d.axis))];
  const axisTotals = allAxes.map(a => ({ axis: a, total: DATA.filter(d => d.axis === a).length }));
  axisTotals.sort((a,b) => b.total - a.total);
  const sortedAxes = axisTotals.map(a => a.axis);
  const warnCounts = sortedAxes.map(a => DATA.filter(d => d.axis === a && d.event_type === 'ALERT').length);
  const critCounts = sortedAxes.map(a => DATA.filter(d => d.axis === a && d.event_type === 'ERROR').length);
  Plotly.newPlot('chartByAxis', [
    { x: sortedAxes, y: warnCounts, name: 'Warning', type: 'bar', marker: { color: '#f0a500' } },
    { x: sortedAxes, y: critCounts, name: 'Critical', type: 'bar', marker: { color: '#e74c3c' } }
  ], {
    barmode: 'stack',
    title: { text: 'Most Affected Axes Across All Robots', font: { color: '#fff', size: 16 } },
    yaxis: { title: 'Number of Anomalies', color: '#a0a0b8', gridcolor: '#1e2a4a' },
    xaxis: { color: '#a0a0b8' },
    paper_bgcolor: '#16213e', plot_bgcolor: '#16213e',
    legend: { font: { color: '#e0e0e0' } },
    margin: { t: 50, b: 40, l: 50, r: 20 }
  }, { responsive: true });
})();

// ---- Chart: Deviation Timeline ----
(function(){
  const warnPts = DATA.filter(d => d.event_type === 'ALERT');
  const critPts = DATA.filter(d => d.event_type === 'ERROR');
  const hoverTpl = 'Robot: %{customdata[0]} | Axis: %{customdata[1]}<br>Type: %{customdata[2]} | Severity: %{y:.2f}<br>Duration: %{customdata[3]}s | Time: %{x}<extra></extra>';
  Plotly.newPlot('chartTimeline', [
    {
      x: warnPts.map(d => d.timestamp), y: warnPts.map(d => d.deviation),
      customdata: warnPts.map(d => [d.robot, d.axis, 'Warning', d.duration_seconds]),
      mode: 'markers', name: 'Warning', type: 'scatter',
      marker: { color: '#f0a500', size: 7, opacity: 0.75 },
      hovertemplate: hoverTpl
    },
    {
      x: critPts.map(d => d.timestamp), y: critPts.map(d => d.deviation),
      customdata: critPts.map(d => [d.robot, d.axis, 'Critical', d.duration_seconds]),
      mode: 'markers', name: 'Critical', type: 'scatter',
      marker: { color: '#e74c3c', size: 9, opacity: 0.85 },
      hovertemplate: hoverTpl
    }
  ], {
    title: { text: 'Anomaly Timeline \u2014 When Did Issues Occur?', font: { color: '#fff', size: 16 } },
    xaxis: { title: 'Time', color: '#a0a0b8', gridcolor: '#1e2a4a' },
    yaxis: { title: 'Severity (deviation from expected behavior)', color: '#a0a0b8', gridcolor: '#1e2a4a' },
    paper_bgcolor: '#16213e', plot_bgcolor: '#16213e',
    legend: { font: { color: '#e0e0e0' } },
    margin: { t: 50, b: 50, l: 60, r: 20 }
  }, { responsive: true });
})();

// ---- Populate robot filter ----
(function(){
  const sel = document.getElementById('filterRobot');
  robots.forEach(r => { const o = document.createElement('option'); o.value = r; o.textContent = r; sel.appendChild(o); });
})();

// ---- Event Log Table with filtering & sorting ----
let sortCol = 'timestamp';
let sortAsc = true;
let filteredData = [...DATA];

function renderEventTable() {
  const robotFilter = document.getElementById('filterRobot').value;
  const typeFilter = document.getElementById('filterType').value;
  filteredData = DATA.filter(d => {
    if (robotFilter !== 'all' && d.robot !== robotFilter) return false;
    if (typeFilter !== 'all' && d.event_type !== typeFilter) return false;
    return true;
  });
  // Sort
  filteredData.sort((a,b) => {
    let va = a[sortCol], vb = b[sortCol];
    if (typeof va === 'number') return sortAsc ? va - vb : vb - va;
    va = String(va); vb = String(vb);
    return sortAsc ? va.localeCompare(vb) : vb.localeCompare(va);
  });
  const body = document.getElementById('eventBody');
  body.innerHTML = '';
  filteredData.forEach(d => {
    const tr = document.createElement('tr');
    tr.className = d.event_type === 'ERROR' ? 'row-crit' : 'row-warn';
    tr.innerHTML =
      '<td>' + fmtTime(d.timestamp) + '</td>' +
      '<td>' + d.robot + '</td>' +
      '<td>' + d.axis + '</td>' +
      '<td>' + typeBadge(d.event_type) + '</td>' +
      '<td>' + (d.deviation != null ? d.deviation.toFixed(4) : '') + '</td>' +
      '<td>' + d.duration_seconds + '</td>' +
      '<td>' + (d.actual_value != null ? d.actual_value.toFixed(4) : '') + '</td>' +
      '<td>' + (d.predicted_value != null ? d.predicted_value.toFixed(4) : '') + '</td>';
    body.appendChild(tr);
  });
  // Update sort arrows
  document.querySelectorAll('#eventTable th').forEach(th => {
    const col = th.getAttribute('data-col');
    const arrow = col === sortCol ? (sortAsc ? ' \u25B2' : ' \u25BC') : '';
    th.innerHTML = th.textContent.replace(/ [\u25B2\u25BC]/, '') + '<span class="sort-arrow">' + arrow + '</span>';
  });
}

document.getElementById('filterRobot').addEventListener('change', renderEventTable);
document.getElementById('filterType').addEventListener('change', renderEventTable);
document.querySelectorAll('#eventTable th').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.getAttribute('data-col');
    if (!col) return;
    if (sortCol === col) { sortAsc = !sortAsc; } else { sortCol = col; sortAsc = true; }
    renderEventTable();
  });
});

renderEventTable();
</script>
</body>
</html>